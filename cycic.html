<!DOCTYPE = HTML>
<html lang="en">
	<title> Cycic</title>
<head>
	<meta charset="utf-8"/>
	<!-- Banner Style Sheet -->
	<link rel="stylesheet" type ="text/css" href="banner.css" />
	<!-- Banner 2 Style Sheet -->
	<link rel="stylesheet" type ="text/css" href="banner2.css" />
	<!-- Sidebar Style Sheet -->
	<link rel="stylesheet" type ="text/css" href="sidebar.css" />
	<!-- Timeline Style Steet -->
	<link rel="stylesheet" type ="text/css" href="timeline-start.css"/>
	<!-- Stylesheet for custumization -->
	<link rel="stylesheet" type ="text/css" href="style.css"/>
	<!-- Stylesheet for sandbox -->
	<link rel="stylesheet" type ="text/css" href="Sandbox.css"/>
	<!--Google Fonts-->
	<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Dancing+Script|Antic+Slab"/>
	<!--if IE 9-->
	<script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"> </script>
	<!-- JavaScript + jQuery-->
	<script src="d3.v2.min.js"> </script>
    <script type="text/javascript" src="rgbcolor.js"></script> 
    <script type="text/javascript" src="canvg.js"></script> 
	<script src="http://code.jquery.com/jquery-1.7.1.min.js"> </script>
	<script src="jquery.dform=1.0.0.min.js"> </script>
	<script src="http://static.simile.mit.edu/timeline/api-2.3.0/timeline-api.js" type ="text/javascript"> </script>
	<script src="facility_view.js"> </script>
	<script src="functions.js"> </script>
	<script src="facilities.js"> </script>
	<script src="Nodes.js"> </script>	
	<script src="script.js"> </script>
	<script src="markets.js"> </script>
	<script src="region.js"> </script>
	<script src="institutions.js"> </script>
	<script src="JavaScriptParser/jsParser.js"> </script>
	<script src="material.js"> </script>
	<!-- Kinetic Plug In -->
	<script src="http://www.html5canvastutorials.com/libraries/kinetic-v3.10.2.js"> </script>
	<!-- facyBox Plug In -->
    <link href="facybox.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="facybox_urls.css" media="screen" rel="stylesheet" type="text/css" />
    <script src="facybox.js" type="text/javascript"></script>
</head>

<body>
	<!-- Banner Mark-up -->
	<header id="banner">
		<ul class="menu">
			<li class ="active"><a href="#">File</a>
				<ul>
					<li><a href="#" class="new_project"> New Project </a></li>
					<li><a href="#" class="save_project"> Save Project </a></li>
					<li><a class="open_project"> Open Project </a></li>
				</ul>
			</li>
			
			<li><a href = "#"> Project </a>
				<ul>
					<li><a style ="cursor:hand; cursor:pointer" onclick = "saveFCDiagramPng($('#sandbox_3').children()[1])" class = "FWindow"> Save Fuel Cycle Diagram </a></li>
					<li><a style ="cursor:hand; cursor:pointer" onclick = "saveFCDiagramPng($('#Facility_View').children()[1])" class = "FWindow"> Save Facility View Diagram </a></li>
				</ul>
			</li>
			<li><a href ="#"> Edit </a></li>
			<li><a href ="#"> View </a>
				<ul>
					<li><a style ="cursor:hand; cursor:pointer" onclick = "toFuelCyclView()" class = "FCWindow"> Fuel Cycle View </a></li>
					<li><a style ="cursor:hand; cursor:pointer" onclick = "toFacilityView()" class = "FWindow"> Facility View </a></li>
					<li><a style ="cursor:hand; cursor:pointer" onclick = "switchToInfo()" class ="fuelCycleInfo"> Fuel Cycle Information </a></li>
					<li><a style ="cursor:hand; cursor:pointer" onclick = "switchToVWindow()" class = "VWindow"> Table View </a></li>
					<li><a style ="cursor:hand; cursor:pointer" onclick = "switchToTimeline()" class = "Timeline"> Timeline </a></li>
					<li><a style ="cursor:hand; cursor:pointer" class="market_mode"> Market View </a></li>
				</ul>
			</li>
			<li><a href = "#"><strike> New Facility Type </strike> </a></li>
			<li><a style="cursor:hand; cursor: pointer" onclick ="testingFunction()" class = "testing"> dForms Test </a></li>
			<li><a style="cursor:hand; cursor: pointer"  class = "testing"> Help </a>
				<ul>
					<li><a style ="cursor:hand; cursor:pointer"> Documentation </a></li>
					<li><a style ="cursor:hand; cursor:pointer" onclick ="vegeta()"> About Cycic </a></li>
					<li><a style ="cursor:hand; cursor:pointer" onclick ="callRobert()"> Call Robert </a></li>
				</ul>
			</li>
		</ul>
	</header>
	<!-- Sidebar Wrapper Test -->
	<div id="wrapper">
		<ul class="sidebar_menu">
			<li class="region_type"><a href="#"> Regions <span class = "total" > </span></a>
				<ul>
					<li class="region" id = "united_states"><a href="#"> United States </a>
						<ul>
						</ul>
					</li>
					<li class="region" id = "country_of_texas"><a href="#"> Country of Texas </a>
						<ul>
						</ul>
					</li>
					<li><a style ="cursor:hand; cursor:pointer" onClick = "newRegionForm()"> Add New Region </a></li>
				</ul>
			</li>
			<li class="institution_type"><a href="#"> Institutions <span class = "total"> </span></a>
				<ul>
					<li class="institution" id = "constellation_energy"><a href="#"> Constellation Energy </a>
						<ul>
						</ul>
					</li>
					<li class="institution" id = "STP"><a href="#"> STP </a>
						<ul>
						</ul>
					</li>
					<li class="institution" id = "blah_blah"><a href="#"> Blah Blah </a>
						<ul>
						</ul>
					</li>
					<li><a style ="cursor:hand; cursor:pointer" onClick = "newInstitutionForm()"> Add New Institution </a></li>
				</ul>
			</li>
			<li class="market_type"><a href="#"> Markets <span class = "total"> </span></a>
				<ul>
					<li><a style ="cursor:hand; cursor:pointer" onClick = "newMarketForm()"> Add New Market</a></li>
				</ul>
			</li>
			<li class="material_type"><a href="#"> Materials <span class = "total"> </span></a>
				<ul>
					<li><a style ="cursor:hand; cursor:pointer" onClick = "newMaterialForm()"> Add New Material </a></li>
				</ul>
			</li>
			<li class="custom_facilities"><a href="#"> Custom Facilities <span class = "total"> </span></a>
				<ul>
					<li class = "storage facility"><a style ="cursor:hand; cursor:pointer" onClick = "openFacilityForm()" > Storage Facility </a></li>
					<li><a style ="cursor:hand; cursor:pointer"> Add New Custom Facility </a></li>
				</ul>
			</li>
		</ul>
		<ul class="facilities_menu">
			<li><a style="cursor:hand; cursor:pointer"> Facility <span class = "total"> </span></a>
				<ul>
					<li><a style ="cursor:hand; cursor:pointer" onClick = "newFacilityForm()"> Add New Facility </a></li>
				</ul>
			</li>
		</ul>
	</div>
	<!-- Sandbox Div -->
	<div id ="sandbox">
		<div id ="form_sandbox">
			<div id = "sandbox_1">
				<p align = "center"> Form Information </p>
				<form id = "sandbox_form">
				
				</form>
			</div>	
			<div id = "submit_area">
				<form id ="sandbox_form_2">
					
				</form>
			</div>			

		</div>
		<div id = "sandbox_2">
			<p align = "center"> Additional Form Information </p>
		</div>
		<div id = "sandbox_4">
			<div id ="fuelCycleInfo">
				<p align = "center"> Fuel Cycle Information </p>
				<form id = "fuel_cycle_information">
					<p> Fuel Cycle Name:  <input type = "text" name = "fc_name" onsubmit=function(){return false;}/> </p>
					<p> Fuel Cycle Abstract: </p> 
					<textarea name = "fc_abstract" rows=4 cols=40> Enter Fuel Cycle Abstract </textarea> 
					<p> Fuel Cycle Comments: </p>
					<textarea name = "fc_comments" rows=4 cols=40> Comments on Fuel Cycle </textarea> 
				</form>
			</div>
			<div id = "variableWindow">
				<p> TABLE Or Other STUFF </p>
			</div>
			<div id = "timeline"></div>
		</div>
		<div id = "fuel_cycle_sandbox">
			<div id = "sandbox_3">
				<p align="center"> Fuel Cycle Diagram </p>
			</div>
			<div id = "Facility_View">
				<p align ="center"> Facility View </p>
			</div>
			<div id = "pngImage">
                <canvas id="pngCanvas" width="800px" height="600px"></canvas> 
            </div>
		</div>
	</div>
	
	<!-- Number counters for sidebar -->
	<script language = JavaScript>
		$('ul li ul').each(function(){
		  	$(this).prev('a').find('.total').append('<div>'+ ($(this).find('li').length - $(this).find('li > ul > li').length - 1) +'</div>');
		});
		$('form').submit(function(e){
   			 e.preventDefault();
		});
	</script>
	<!-- Variables -->
	<script type ="text/javascript">
		var facilities = {};
		var customFacilities = {};
		var MARKETS = {};
		var MATERIALS = {};
		var NAME;
		var REGION;
		var INSTITUTION;
		var TYPE;
		var PARENT;
		var MODEL;
		
		var w = document.getElementById("sandbox_3").offsetWidth,
		    h = document.getElementById("sandbox_3").offsetHeight,
		    Fnodes = [],
		    Tnodes= [],
		    links = [],
		    Tlinks = [],
	    	Fnodes_f = [],
	    	links_f = [];
    	
    	var timelineJSON = {
    		'dateTimeFormat': 'iso8601',
			'wikiURL': ".",
			'wikiSection': ".",
			
			'events' : [{'start': '2010',
        				'title': 'Test Reactor',
        				'description': 'Robert Flanagan Rules',
        				'isDuration': false,
        				'color': "blue"},
        				{'start': '2012',
        				'title': 'Fast Reactor Start Up',
        				'description': 'Robert Flanagan Rules',
        				'isDuration': false}]
    	}
	</script>
	<!-- Hiding the side menus -->
	<script type ="text/javascript">
		var menu_ul = $('.sidebar_menu > li > ul'), 
		menu_a = $('.sidebar_menu > li > a');
		var menu_ul_1 = $('.sidebar_menu > li > ul > li > ul'),
		menu_a_1 = $('.sidebar_menu > li > ul > li > a');
		collapseTop();
		collapseBottom();
		function collapseTop(){
			menu_ul.hide();
			
			menu_a.click(function(e){
				e.preventDefault();
				if(!$(this).hasClass('active')) {
					menu_a.removeClass('active');
					/*menu_ul.filter(':visible').slideUp('normal');*/
					$(this).addClass('active').next().stop(true,true).slideDown('normal');
				}
				else{
					$(this).removeClass('active');
					$(this).next().stop(true,true).slideUp('normal');
				}
			});
		}
		function collapseBottom(){
			menu_ul_1.hide();
			
			menu_a_1.click(function(e){
				e.preventDefault();
				if(!$(this).hasClass('active1')) {
					menu_a_1.removeClass('active1');
					menu_ul_1.filter(':visible').slideUp('normal');
					$(this).addClass('active1').next().stop(true,true).slideDown('normal');
					if(document.getElementsByClassName('active_test').length > 0){
						document.getElementsByClassName('active_test')[0].classList.remove('active_test');
						$('').replaceAll('.facilities_menu > li > ul > li');
						document.getElementById('wrapper').style.display = 'none';					
						document.getElementById('wrapper').style.display = 'block';
						$('.facilities_menu > li > ul').append('<li><a style ="cursor:hand; cursor:pointer" onClick = "newFacilityForm()"> Add New Facility </a></li>');	
					}					
					$(this).closest('li').addClass('active_test');
					$('.active_test > ul > li').clone().prependTo($('.facilities_menu > li > ul'));
					updateSidebar();
				}
				else{
					$(this).removeClass('active1');
					$(this).closest('li').removeClass('active_test');
					$(this).next().stop(true,true).slideUp('normal');
					document.getElementById('wrapper').style.display = 'none';
					$('').replaceAll('.facilities_menu > li > ul > li');
					$('.facilities_menu > li > ul').append('<li><a style ="cursor:hand; cursor:pointer" onClick = "newFacilityForm()"> Add New Facility </a></li>');
					updateSidebar();								
					document.getElementById('wrapper').style.display = 'block';
				}
					
			});				
		}
		
		function updateSidebar(){
			$('ul li ul').each(function(){
				$(this).prev('a').find('.total').find('div').remove()
	  			$(this).prev('a').find('.total').append('<div>'+ ($(this).find('li').length - $(this).find('li > ul > li').length - 1) +'</div>');
			});
			var menu_ul = $('.sidebar_menu > li > ul'), 
			menu_a = $('.sidebar_menu > li > a');
			var menu_ul_1 = $('.sidebar_menu > li > ul > li > ul'),
			menu_a_1 = $('.sidebar_menu > li > ul > li > a');
			<link rel="stylesheet" type ="text/css" href="sidebar.css" />
		}
	</script>
	<!-- Bubbles!-->
    <script type="text/javascript">	
		// Main Force //     
		var vis = d3.select("#sandbox_3").append("svg:svg")
		    .attr("width", w)
		    .attr("height", h);
		    
		var force = d3.layout.force()
		    .linkStrength(function(d){if(d['target']['call'] == "child"){ return 1;} else{return 0;}})		
			.linkDistance(150)
			.charge(function(d){if(d['call'] == "child"){return -220;}else{return 0;}})
			.nodes(Fnodes)
		    .links(links)
		    .size([w, h])
		    .gravity(0)
		    .friction(0)
		    
	    force.on("tick", function(){
  			vis.selectAll("g.node")
  				.attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; });
			vis.selectAll("line.link")
			      .attr("x1", function(d) { return d.source.x; })
			      .attr("y1", function(d) { return d.source.y; })
			      .attr("x2", function(d) { return d.target.x; })
			      .attr("y2", function(d) { return d.target.y; });
		});
		
		// Facility Force // 
		var vis2 = d3.select("#Facility_View").append("svg:svg")
		    .attr("width", w)
		    .attr("height", h);		
		    		    
		var force2 = d3.layout.force()
		    .linkStrength(function(d){if(d['target']['call'] == "child"){ return 1;} else{return 0;}})		
			.linkDistance(200)
			.nodes(Fnodes_f)
		    .links(links_f)
		    .size([w, h])
		    .gravity(0)
		    .friction(0)
		    
	    force2.on("tick", function(){
  			vis2.selectAll("g.node")
  				.attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; });
			vis2.selectAll("line.link")
			      .attr("x1", function(d) { return d.source.x; })
			      .attr("y1", function(d) { return d.source.y; })
			      .attr("x2", function(d) { return d.target.x; })
			      .attr("y2", function(d) { return d.target.y; });
		});   		    
	</script>
	<!-- Timeline scripts -->
	<script type="text/javascript">
		var tl;
		var eventSource = new Timeline.DefaultEventSource();
		var theme1 = new Timeline.ClassicTheme.create();
			theme1.timeline_start = new Date(Date.UTC(1960, 0, 1));
		var bands = [
     		Timeline.createBandInfo({
		         width:          "30%", 
		         intervalUnit:   Timeline.DateTime.DECADE, 
		         intervalPixels: 80,
		         eventSource: eventSource
		     }),
		     Timeline.createBandInfo({
		         width:          "70%", 
		         intervalUnit:   Timeline.DateTime.YEAR, 
		         intervalPixels: 100,
		         eventSource: eventSource
		     })
   		];
   		bands[1].syncWith = 0;
   		bands[1].highlight = true;
   		tl = Timeline.create(document.getElementById('timeline'), bands);
   		var url = '.';
   		eventSource.loadJSON(timelineJSON, url);
   		
		document.getElementById('fuelCycleInfo').style.display = 'block';
		document.getElementById('variableWindow').style.display = 'none';
		document.getElementById('timeline').style.display = 'none';
	</script>
</body>
</html>
