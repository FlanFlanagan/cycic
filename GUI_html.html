<!DOCTYPE = HTML>
<html lang="en">
	<title> Cycic GUI </title>
<head>
	<meta charset="utf-8"/>
	<!-- Banner Style Sheet -->
	<link rel="stylesheet" type ="text/css" href="banner.css" />
	<!-- Banner 2 Style Sheet -->
	<link rel="stylesheet" type ="text/css" href="banner2.css" />
	<!-- Sidebar Style Sheet -->
	<link rel="stylesheet" type ="text/css" href="sidebar.css" />
	<!-- Timeline Style Steet -->
	<link rel="stylesheet" type ="text/css" href="timeline.css"/>
	<!-- Stylesheet for custumization -->
	<link rel="stylesheet" type ="text/css" href="style.css"/>
	<!-- Stylesheet for sandbox -->
	<link rel="stylesheet" type ="text/css" href="Sandbox.css"/>
	<!--Google Fonts-->
	<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Dancing+Script|Antic+Slab"/>
	<!--if IE 9-->
	<script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"> </script>
	<!-- d3.js -->
    <script type="text/javascript" src="http://mbostock.github.com/d3/d3.js?1.25.0"> </script>
    <script type="text/javascript" src="http://mbostock.github.com/d3/d3.geom.js?1.25.0"> </script>
    <script type="text/javascript" src="http://mbostock.github.com/d3/d3.layout.js?1.25.0"> </script>
	<!-- JavaScript + jQuery-->
	<script src="http://code.jquery.com/jquery-1.7.1.min.js"> </script>
	<script src="timeline-start.js"> </script>
	<script src="script.js"> </script>
	<!-- Kinetic Plug In -->
	<script src="http://www.html5canvastutorials.com/libraries/kinetic-v3.10.2.js"> </script>
</head>

<body>
	<!-- Banner Mark-up -->
	<header id="banner">
		<ul class="menu">
			<li class ="active"><a href="#">File</a>
				<ul>
					<li><a href="#" class="new_project"> New Project </a></li>
					<li><a href="#" class="save_project"> Save Project </a></li>
					<li><a href="#" class="open_project"> Open Project </a></li>
				</ul>
			</li>
			
			<li><a href = "#"> Project </a></li>
			<li><a href ="#"> Edit </a></li>
			<li><a href ="#"> Mode </a>
				<ul>
					<li><a href="#" class="market_mode"> Market Mode </a></li>
					<li><a href="#" class="construction_mode"> Construction Mode</a></li>
					<li><a href="#" class="time_depentent_mode"> Time Dependent Mode</a></li>
				</ul>
			</li>
			<li><a href = "#"><strike> New Facility Type </strike> </a></li>
		</ul>
	</header>
	
	<!-- Banner 2 Mark-up-->
	
	<!-- Timeline Mark-up -->
	
	<!-- Sidebar Wrapper Test -->
	<div id="wrapper">
		<ul class="sidebar_menu">
			<li class="region_type"><a href="#"> Regions <span class = "total" > </span></a>
				<ul>
					<li class="region" id = "united_states"><a href="#"> United States </a>
						<ul>
						</ul>
					</li>
					<li class="region" id = "country_of_texas"><a href="#"> Country of Texas </a>
						<ul>
						</ul>
					</li>	
					<li><a style ="cursor:hand; cursor:pointer" onClick = "openNewRegionForm()"> Add New Region </a></li>
				</ul>
			</li>
			<li class="institution_type"><a href="#"> Institutions <span class = "total"> </span></a>
				<ul>
					<li class="institution" id = "constellation_energy"><a href="#"> Constellation Energy</a>
						<ul>
						</ul>
					</li>
					<li class="institution" id = "STP"><a href="#"> STP </a>
						<ul>
						</ul>
					</li>
					<li class="institution" id = "blah_blah"><a href="#"> Blah Blah</a>
						<ul>
						</ul>
					</li>
					<li><a href="#"> Add New Institution </a></li>
				</ul>
			</li>
			<li class="market_type"><a href="#"> Markets <span class = "total"> </span></a>
				<ul>
					<li><a href="#"> Add New Market</a></li>
				</ul>
			</li>
			<li class="custom_facilities"><a href="#"> Custom Facilities <span class = "total"> </span></a>
				<ul>
					<li class = "storage facility"><a style ="cursor:hand; cursor:pointer" onClick = "openFacilityForm()" > Storage Facility </a></li>
					<li><a style ="cursor:hand; cursor:pointer" onClick = "openFacilityForm()"> Add New Custom Facility </a></li>
				</ul>
			</li>
		</ul>
		<ul class="facilities_menu">
			<li><a style="cursor:hand; cursor:pointer"> Facility <span class = "total"> </span></a>
				<ul>
					<li><a style ="cursor:hand; cursor:pointer" onClick = "newFacilityForm()"> Add New Facility </a></li>
				</ul>
			</li>
		</ul>
	</div>
	<!-- Sandbox Div -->
	<div id ="sandbox">
		<div id ="sandbox_1">
			<p align = "center">Form Information Here, maybe? </p>
			<form id = "sandbox_form">
				
			</form>
		</div>
		<div id = "sandbox_2">
			<p align = "center"> Alternate View </p>
		</div>
		<div id = "sandbox_3">
			<p align = "center">Fuel Cycle Diagram Here! </p>
		</div>
	</div>
	
	<!-- Number counters for sidebar -->
	<script language=JavaScript>
		$('ul li ul').each(function(){
		  	$(this).prev('a').find('.total').append('<div>'+ ($(this).find('li').length - $(this).find('li > ul > li').length - 1) +'</div>');
		});
	</script>
	<!-- Add New Buttons -->
	<script type ="text/javascript">
		var facilities = {};
		var customFacilities = {};
		var NAME;
		var REGION;
		var INSTITUTION;
		function newFacilityForm(){
			$('#sandbox_1 form p, button, select, input, br, b, option').replaceWith('');
			$('#sandbox_1 form').prepend('<p> Facility Name:  <input type = "text" name = "region_name"/> </p>');			
			$('#sandbox_1 form').append('<p> Region: <select id = "region_select"> </select> </p>');
			$('#sandbox_1 form').append('<p> Institution: <select id = "institution_select"> </select> </p>');
			$('#sandbox_1 form').append('<p> Facility Type: <select id = "facility_select"> </select> </p>');
			for(i = 0; i < $('.region_type ul li').length-1; i ++){
				if($('.region_type ul li')[i].hasAttribute('class')===true){
					$('#region_select').append('<option value ="'+$('.region_type ul li')[i].id.toLowerCase()+'">' + $(".region_type ul li")[i].id.toUpperCase() +'</option>');
				}
			}
			for(i = 0; i < $('.institution_type ul li').length-1; i ++){
				if($('.institution_type ul li')[i].hasAttribute('class')===true){
					$('#institution_select').append('<option value ="'+$('.institution_type ul li')[i].id.toLowerCase()+'">' + $(".institution_type ul li")[i].id.toUpperCase() +'</option>');
				}
			}
			for(i = 0; i < $('.custom_facilities ul li').length-1; i ++){
				$('#facility_select').append('<option value ="'+$('.custom_facilities ul li')[i].className.toLowerCase()+'">' + $(".custom_facilities ul li")[i].className.toUpperCase() +'</option>');
				if(i = $('.custom_facilities ul li').length-1){
					$('#sandbox_1 form').append('<button name = "submit_New_Facility" type="submit" onClick="openNewFacilityForm()"> Submit </button>');
				}
			}
			/*for(i = 0; i < $('.custom_facilities ul li').length-1; i ++){
				$('#sandbox_1 form').append('<br /><input type ="radio"> <b>' + $(".custom_facilities ul li")[i].className.toUpperCase()+'</b>');
			}*/
			document.getElementById('sandbox_1').style.display = 'none';					
			document.getElementById('sandbox_1').style.display = 'block';		
		}
		function openNewFacilityForm(){
			window.NAME = document.getElementById('sandbox_form')[0].value;
			window.REGION = document.getElementById('sandbox_form')[1].value;
			window.INSTITUTION = document.getElementById('sandbox_form')[2].value;
			$('#sandbox_1 form p, button, input, br, select, b, option').replaceWith('');
			$.getJSON("JavaScriptParser/sample_interface/storagefacility.json", function(data){				
				for(var i =0; i < data[1].length; i++){
						$('#sandbox_1 form').append('<p>' + data[1][i][0].toUpperCase() + '<input type="text" name ="' + data[1][i][0] +'" value ="' + data[1][i][1] + '"/> </p>');
					}
				$('#sandbox_1 form').append('<button name = "submit_Facility" type="button" onClick="printout()"> Submit </button>');
			});
			document.getElementById('sandbox_1').style.display = 'none';					
			document.getElementById('sandbox_1').style.display = 'block';
		}
		function openFacilityForm(facility){
			$('#sandbox_1 form p, button, input, br, select, b, option').replaceWith('');			
			for(attribute in facilities[facility]){
				var STR = attribute;
				window.NAME = facility;
				$('#sandbox_1 form').append('<p>' + attribute.toUpperCase() + '<input type="text" name ="' + attribute +'" value ="' + facilities[facility][STR] + '"/>');
			}
			$('#sandbox_1 form').append('<button name = "submit_Facility" type="button" onClick="printout()"> Submit </button>');
			document.getElementById('sandbox_1').style.display = 'none';					
			document.getElementById('sandbox_1').style.display = 'block';
		}
		function openNewRegionForm(){
		}
		function printout(){
			
			function testing(){
				var length_2 = document.getElementById('sandbox_form').length;
				var facility = {};
				facility['Name'] = window.NAME;
				facility['Region'] = window.REGION;
				facility['Institution'] = window.INSTITUTION;
				for(i=0; i<length_2-1; i++){
					facility[document.getElementById('sandbox_form')[i].name] = document.getElementById('sandbox_form')[i].value;
				}
				return facility;			
			}
			if(!facilities[window.NAME]){
				window.facilities[window.NAME] = testing();
				$('#'+facilities[window.NAME].Region +' ul').append('<li><a style ="cursor:hand; cursor:pointer" onClick = "openFacilityForm(facilities.' + window.NAME+'.Name)" >' + facilities[window.NAME].Name);
				$('#'+facilities[window.NAME].Institution +' ul').append('<li><a style ="cursor:hand; cursor:pointer" onClick = "openFacilityForm(facilities.' + window.NAME+'.Name)" >' + facilities[window.NAME].Name);
				addNewCircle();
			}
			window.facilities[window.NAME] = testing();
			return facilities;
		}
	</script>
	<!-- Hiding the side menus -->
	<script type ="text/javascript">
		$(function(){
			var menu_ul = $('.sidebar_menu > li > ul'), 
				menu_a = $('.sidebar_menu > li > a');
			
			menu_ul.hide();
			
			menu_a.click(function(e){
				e.preventDefault();
				if(!$(this).hasClass('active')) {
					menu_a.removeClass('active');
					/*menu_ul.filter(':visible').slideUp('normal');*/
					$(this).addClass('active').next().stop(true,true).slideDown('normal');
				}
				else{
					$(this).removeClass('active');
					$(this).next().stop(true,true).slideUp('normal');
				}
			});
		});
		
		$(function(){
			var menu_ul_1 = $('.sidebar_menu > li > ul > li > ul'),
				menu_a_1 = $('.sidebar_menu > li > ul > li > a');
			
			menu_ul_1.hide();
			
			menu_a_1.click(function(e){
				e.preventDefault();
				if(!$(this).hasClass('active1')) {
					menu_a_1.removeClass('active1');
					menu_ul_1.filter(':visible').slideUp('normal');
					$(this).addClass('active1').next().stop(true,true).slideDown('normal');
					if(document.getElementsByClassName('active_test').length > 0){
						document.getElementsByClassName('active_test')[0].classList.remove('active_test');
						$('').replaceAll('.facilities_menu > li > ul > li');
						document.getElementById('wrapper').style.display = 'none';					
						document.getElementById('wrapper').style.display = 'block';
						$('.facilities_menu > li > ul').append('<li><a style ="cursor:hand; cursor:pointer" onClick = "newFacilityForm()"> Add New Facility </a></li>');	
					}					
					$(this).closest('li').addClass('active_test');
					$('.active_test > ul > li').clone().prependTo($('.facilities_menu > li > ul'));

				}
				else{
					$(this).removeClass('active1');
					$(this).closest('li').removeClass('active_test');
					$(this).next().stop(true,true).slideUp('normal');
					document.getElementById('wrapper').style.display = 'none';
					$('').replaceAll('.facilities_menu > li > ul > li');
					$('.facilities_menu > li > ul').append('<li><a style ="cursor:hand; cursor:pointer" onClick = "newFacilityForm()"> Add New Facility </a></li>');									
					document.getElementById('wrapper').style.display = 'block';
				}
					
			});	
		});
		
		function toTitleCase(str){
	    	return str.replace(/\w\S*/g, function(txt){
	    		return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();
	    	});
		}
	</script>
	<!-- Bubbles! Maybe -->
    <script type="text/javascript">	
		var w = document.getElementById("sandbox_3").offsetWidth,
		    h = document.getElementById("sandbox_3").offsetHeight,
		    nodes = [],
		    node;
		
		var vis = d3.select("#sandbox_3").append("svg:svg")
		    .attr("width", w/1.018)
		    .attr("height", h/1.178);
		
		var force = d3.layout.force()
			.nodes(nodes)
		    .links([])
		    .size([w, h])
		    .gravity(0)
		    .friction(0);
		    
	    force.on("tick", function(e) {
  			vis.selectAll("g.node")
      			.attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; });
			});
		    
		function addNewCircle(){
			nodes.push({
				name: window.NAME,
		  		type: d3.svg.symbol("circle"),
		    	size: 50,
		    	x: 100,
		    	y: 100
		  	});
		  	force.start();			  	
		  	var node = vis.selectAll("g.node")
		  		.data(nodes);
		  		
	  		node.enter().append("svg:g")
	  		     .attr("class", "node")
	  			 .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; })
	  			 .call(force.drag);
	  		node.append("title")
	  			.text(function(d) {return d.name;})
  			node.append("circle")
  				.attr("r", function(d) {return d.size;})
  				.style("fill", "steelblue")
	  			.style("stroke", "white")
	  			.style("stroke-width", "1.5px")
	  			
  			node.append("text")
  				.attr("text-anchor", "middle")
  				.attr("dy", ".3em")
  				.text(function(d) {return d.name;});
		 }
	</script>
</body>
</html>